<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>100mã‚°ãƒªãƒƒãƒ‰ ğŸŒ è¡¨ç¤ºãƒ‡ãƒ¢</title>
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center; }
  #status { margin-bottom: 20px; font-size: 16px; }
  #banana { font-size: 100px; display: none; }
</style>
</head>
<body>
<h1>100mã‚°ãƒªãƒƒãƒ‰ ğŸŒ è¡¨ç¤ºãƒ‡ãƒ¢</h1>
<div id="status">ä½ç½®æƒ…å ±å–å¾—ä¸­â€¦</div>
<div id="banana">ğŸŒ</div>

<script>
  const GRID_SIZE = 100; // 100mã‚°ãƒªãƒƒãƒ‰
  const statusEl = document.getElementById("status");
  const bananaEl = document.getElementById("banana");

  // ç·¯åº¦çµŒåº¦ã‹ã‚‰ã‚°ãƒªãƒƒãƒ‰IDã‚’è¨ˆç®—
  function getGridId(lat, lon) {
    const latMeter = 111000; // ç·¯åº¦1åº¦ã‚ãŸã‚Šã®è·é›¢(m)
    const lonMeter = 111000 * Math.cos(lat * Math.PI / 180); // çµŒåº¦1åº¦ã‚ãŸã‚Šã®è·é›¢(m)
    const x = lon * lonMeter;
    const y = lat * latMeter;
    const gx = Math.floor(x / GRID_SIZE);
    const gy = Math.floor(y / GRID_SIZE);
    return `${gx}_${gy}`;
  }

  // è¡¨ç¤ºåˆ‡æ›¿
  function showBanana(gridId) {
    if (gridId === "123036_140697") {
      bananaEl.style.display = "block";
      statusEl.textContent = "ğŸŒ ã‚°ãƒªãƒƒãƒ‰ã«ã„ã¾ã™ï¼";
    } else {
      bananaEl.style.display = "none";
      statusEl.textContent = "ç¾åœ¨ã®ã‚°ãƒªãƒƒãƒ‰ID: " + gridId;
    }
  }

  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½ç½®è¿½è·¡
  if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const gridId = getGridId(lat, lon);
      showBanana(gridId);
    }, err => {
      statusEl.textContent = "ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼: " + err.message;
      bananaEl.style.display = "none";
    }, {
      enableHighAccuracy: true,
      maximumAge: 0,
      timeout: 10000
    });
  } else {
    statusEl.textContent = "ãƒ–ãƒ©ã‚¦ã‚¶ãŒä½ç½®æƒ…å ±APIã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“";
    bananaEl.style.display = "none";
  }
</script>
</body>
</html>
